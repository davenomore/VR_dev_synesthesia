import"./music-store-Da5ddBIB.js";import"./auto-music-C_xHT18e.js";AFRAME.registerComponent("force-grab",{schema:{target:{type:"selector"},speed:{type:"number",default:10},distance:{type:"number",default:2}},init:function(){this.grabbedObject=null,this.originalDamping=0,this.targetPosition=new THREE.Vector3,this.direction=new THREE.Vector3},grab:function(t){this.grabbedObject||(this.grabbedObject=t,t.body&&(this.originalDamping=t.body.linearDamping,t.body.linearDamping=.9,t.body.angularDamping=.9))},release:function(){this.grabbedObject&&(this.grabbedObject.body&&(this.grabbedObject.body.linearDamping=this.originalDamping,this.grabbedObject.body.angularDamping=.01),this.grabbedObject=null)},tick:function(t,e){if(!this.grabbedObject||!this.grabbedObject.body)return;this.el.object3D.getWorldPosition(this.targetPosition),this.el.object3D.getWorldDirection(this.direction),this.direction.multiplyScalar(-1);const s=this.el.object3D.localToWorld(new THREE.Vector3(0,0,-this.distance)),n=this.grabbedObject.object3D.position,i=new THREE.Vector3().copy(s).sub(n).multiplyScalar(this.data.speed);this.grabbedObject.body.velocity.set(i.x,i.y,i.z)}});AFRAME.registerComponent("invito-summon",{schema:{speed:{type:"number",default:20},arrivalDistance:{type:"number",default:.5}},init:function(){this.targetObject=null,this.originalDamping=0,this.vectorToTarget=new THREE.Vector3},summon:function(t){this.targetObject||(this.targetObject=t,t.body&&(this.originalDamping=t.body.linearDamping,t.body.linearDamping=.1,t.body.angularDamping=.1,t.body.wakeUp()))},release:function(){this.targetObject&&(this.targetObject.body&&(this.targetObject.body.linearDamping=this.originalDamping,this.targetObject.body.velocity.set(0,0,0)),this.targetObject=null)},tick:function(t,e){if(!this.targetObject||!this.targetObject.body)return;const s=this.el.object3D.getWorldPosition(new THREE.Vector3),n=this.targetObject.object3D.getWorldPosition(new THREE.Vector3);if(s.distanceTo(n)<this.data.arrivalDistance){this.release();return}this.vectorToTarget.subVectors(s,n).normalize();const i=this.vectorToTarget.multiplyScalar(this.data.speed);this.targetObject.body.velocity.set(i.x,i.y,i.z)}});AFRAME.registerComponent("spell-caster",{schema:{hand:{type:"string",default:"right"},wandLength:{type:"number",default:.3},wandColor:{type:"color",default:"#5c4033"}},init:function(){this.activeSpell="wingardium_leviosa",this.targetEl=null,this.el.setAttribute("force-grab",""),this.forceGrab=this.el.components["force-grab"],this.wandContainer=document.createElement("a-entity"),this.wandContainer.setAttribute("position","0.04 0.05 -0.1"),this.wandContainer.setAttribute("rotation","-45 0 0");const t=document.createElement("a-entity");t.setAttribute("geometry",`primitive: cylinder; radius: 0.01; height: ${this.data.wandLength}`),t.setAttribute("material",`color: ${this.data.wandColor}`),t.setAttribute("rotation","90 0 0"),t.setAttribute("position",`0 0 -${this.data.wandLength/2}`),this.wandContainer.appendChild(t),this.tip=document.createElement("a-entity"),this.tip.setAttribute("geometry","primitive: sphere; radius: 0.015"),this.tip.setAttribute("material","color: #88ccff; emissive: #88ccff; emissiveIntensity: 0.5"),this.tip.setAttribute("position",`0 0 -${this.data.wandLength}`),this.wandContainer.appendChild(this.tip),this.el.appendChild(this.wandContainer),this.wandContainer.setAttribute("raycaster",{objects:"[grabbable], .clickable",far:20,showLine:!0,lineColor:"#88ccff",lineOpacity:.5,direction:new THREE.Vector3(0,0,-1),origin:new THREE.Vector3(0,0,-this.data.wandLength)}),this.onRaycasterIntersection=this.onRaycasterIntersection.bind(this),this.onRaycasterIntersectionCleared=this.onRaycasterIntersectionCleared.bind(this),this.onGripDown=this.onGripDown.bind(this),this.onGripUp=this.onGripUp.bind(this)},play:function(){this.wandContainer.addEventListener("raycaster-intersection",this.onRaycasterIntersection),this.wandContainer.addEventListener("raycaster-intersection-cleared",this.onRaycasterIntersectionCleared),this.el.addEventListener("gripdown",this.onGripDown),this.el.addEventListener("gripup",this.onGripUp),this.el.addEventListener("pinchstarted",this.onGripDown),this.el.addEventListener("pinchended",this.onGripUp)},pause:function(){this.wandContainer&&(this.wandContainer.removeEventListener("raycaster-intersection",this.onRaycasterIntersection),this.wandContainer.removeEventListener("raycaster-intersection-cleared",this.onRaycasterIntersectionCleared)),this.el.removeEventListener("gripdown",this.onGripDown),this.el.removeEventListener("gripup",this.onGripUp),this.el.removeEventListener("pinchstarted",this.onGripDown),this.el.removeEventListener("pinchended",this.onGripUp)},onRaycasterIntersection:function(t){const e=this.wandContainer.components.raycaster.intersections;e&&e.length>0&&(this.targetEl=e[0].object.el,this.targetEl.setAttribute("material","emissive","#333"),console.log("Wand Hit:",this.targetEl.id),this.tip.setAttribute("material","emissiveIntensity","1.0"))},onRaycasterIntersectionCleared:function(){this.targetEl&&(this.targetEl.setAttribute("material","emissive","#000"),this.targetEl=null,this.tip.setAttribute("material","emissiveIntensity","0.5"))},onGripDown:function(t){if(console.log("Wand Cast:",t?t.type:"unknown"),this.activeSpell==="wingardium_leviosa"&&this.targetEl){if(this.targetEl.getAttribute("scene-restarter")!==null){this.targetEl.emit("click");return}console.log("Force Grabbing",this.targetEl),this.forceGrab.grab(this.targetEl),this.tip.setAttribute("material","color","#ff0000"),this.tip.setAttribute("material","emissive","#ff0000"),this.wandContainer.setAttribute("raycaster","lineColor","#ff0000")}},onGripUp:function(t){this.activeSpell==="wingardium_leviosa"&&(this.forceGrab.release(),this.tip.setAttribute("material","color","#88ccff"),this.tip.setAttribute("material","emissive","#88ccff"),this.wandContainer.setAttribute("raycaster","lineColor","#88ccff"))}});AFRAME.registerComponent("scene-restarter",{init:function(){this.el.addEventListener("click",function(){location.reload()})}});AFRAME.registerComponent("palm-locomotion",{schema:{hand:{type:"string",default:"right"},speed:{type:"number",default:1.5}},init:function(){this.pinching=!1,this.previousHandPos=new THREE.Vector3,this.currentHandPos=new THREE.Vector3,this.delta=new THREE.Vector3,this.rigEl=document.getElementById("rig"),this.onPinchStart=this.onPinchStart.bind(this),this.onPinchEnd=this.onPinchEnd.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStart),this.el.addEventListener("pinchended",this.onPinchEnd)},onPinchStart:function(){this.pinching=!0,this.el.object3D.getWorldPosition(this.previousHandPos)},onPinchEnd:function(){this.pinching=!1},tick:function(){!this.pinching||!this.rigEl||(this.el.object3D.getWorldPosition(this.currentHandPos),this.delta.subVectors(this.currentHandPos,this.previousHandPos),this.rigEl.object3D.position.sub(this.delta.multiplyScalar(this.data.speed)),this.el.object3D.getWorldPosition(this.previousHandPos))}});AFRAME.registerComponent("scene-navigator",{schema:{url:{type:"string"}},init:function(){this.el.addEventListener("click",()=>{this.data.url&&(window.location.href=this.data.url)})}});AFRAME.registerComponent("wrist-menu",{schema:{menuId:{type:"string",default:"menu-panel"},toggleGesture:{type:"string",default:"pinchstarted"}},init:function(){if(this.menuEl=document.getElementById(this.data.menuId),this.visible=!1,!this.menuEl){console.warn("Wrist Menu: Menu element not found with ID",this.data.menuId);return}this.menuEl.setAttribute("visible",!1),this.onToggle=this.onToggle.bind(this),this.el.addEventListener(this.data.toggleGesture,this.onToggle)},onToggle:function(){this.visible=!this.visible,this.menuEl.setAttribute("visible",this.visible),console.log("Wrist Menu Toggled:",this.visible)}});AFRAME.registerComponent("magic-wand",{init:function(){this.activeSpell="wingardium_leviosa",this.isHeld=!1,this.holderEl=null,this.el.setAttribute("raycaster",{objects:"[grabbable], .clickable",far:20,showLine:!0,lineColor:"#88ccff",lineOpacity:.5,enabled:!0}),this.el.setAttribute("force-grab",""),this.forceGrab=this.el.components["force-grab"],this.el.setAttribute("invito-summon",""),this.invito=this.el.components["invito-summon"],this.onGrabStart=this.onGrabStart.bind(this),this.onGrabEnd=this.onGrabEnd.bind(this),this.onTriggerDown=this.onTriggerDown.bind(this),this.onTriggerUp=this.onTriggerUp.bind(this),this.onRayIntersection=this.onRayIntersection.bind(this),this.onRayCleared=this.onRayCleared.bind(this),this.el.addEventListener("grab-start",this.onGrabStart),this.el.addEventListener("grab-end",this.onGrabEnd),this.el.addEventListener("raycaster-intersection",this.onRayIntersection),this.el.addEventListener("raycaster-intersection-cleared",this.onRayCleared),this.el.addEventListener("triggerdown",this.onTriggerDown),this.el.addEventListener("pinchstarted",this.onTriggerDown),this.el.addEventListener("gripdown",this.onTriggerDown),this.el.addEventListener("gripup",this.onTriggerUp),this.el.addEventListener("triggerup",this.onTriggerUp),this.el.addEventListener("pinchended",this.onTriggerUp),console.log("Magic Wand Initialized with Invito")},onGrabStart:function(t){console.log("Wand Grabbed by",t.detail.hand.id),this.isHeld=!0,this.holderEl=t.detail.hand},onGrabEnd:function(t){console.log("Wand Released"),this.isHeld=!1,this.holderEl=null,this.forceGrab.release(),this.invito.release()},onRayIntersection:function(t){const e=t.detail.els;e&&e.length>0&&(this.targetEl=e[0],this.targetEl.setAttribute("material","emissive","#333"),this.el.setAttribute("raycaster","lineColor","#aaccff"))},onRayCleared:function(t){this.targetEl&&(this.targetEl.setAttribute("material","emissive","#000"),this.targetEl=null,this.el.setAttribute("raycaster","lineColor","#88ccff"))},onTriggerDown:function(t){if(!this.isHeld)return;if(console.log("Wand Trigger!",t.type),t.type==="gripdown")this.targetEl&&(console.log("Casting Invito!",this.targetEl),this.invito.summon(this.targetEl),this.el.setAttribute("raycaster","lineColor","#00ff00"));else if(this.targetEl){if(this.targetEl.getAttribute("scene-restarter")!==null){this.targetEl.emit("click");return}console.log("Force Grabbing",this.targetEl),this.forceGrab.grab(this.targetEl),this.el.setAttribute("raycaster","lineColor","#ff0000")}},onTriggerUp:function(t){if(!this.isHeld)return;t.type==="gripup"?(this.invito.release(),this.el.setAttribute("raycaster","lineColor","#88ccff")):(this.forceGrab.release(),this.el.setAttribute("raycaster","lineColor","#88ccff"))}});AFRAME.registerComponent("hand-physics",{schema:{radius:{default:.05},offset:{type:"vec3",default:{x:0,y:0,z:0}}},init:function(){if(this.system=this.el.sceneEl.systems.physics,!this.system){console.error("Physics system not found!");return}this.el.body||this.el.setAttribute("static-body",{shape:"sphere",sphereRadius:this.data.radius}),this.el.addEventListener("body-loaded",t=>{try{this.body=t.detail.body,window.CANNON?(this.body.type=window.CANNON.Body.KINEMATIC,this.body.mass=0,this.body.updateMassProperties(),this.body.collisionFilterGroup=1,this.body.collisionFilterMask=1,console.log("Hand Physics Body Loaded (Kinematic)",this.el.id)):console.warn("CANNON global not found! Physics body might behave unexpectedly.")}catch(e){console.error("Error setting up hand physics body:",e)}})},tick:function(){if(!this.body)return;const t=this.el.object3D.position,e=this.el.object3D.quaternion;this.body.position.set(t.x+this.data.offset.x,t.y+this.data.offset.y,t.z+this.data.offset.z),this.body.quaternion.set(e.x,e.y,e.z,e.w)}});AFRAME.registerComponent("audio-reactive",{schema:{src:{type:"selector"},fftSize:{type:"int",default:2048},smoothing:{type:"number",default:.8},enabled:{type:"boolean",default:!0}},init:function(){this.audioContext=null,this.analyser=null,this.dataArray=null,this.source=null,this.isAudioRunning=!1,this.startAudio=this.startAudio.bind(this),this.onEnterVR=this.onEnterVR.bind(this),["click","touchstart","enter-vr"].forEach(t=>{window.addEventListener(t,this.startAudio,{once:!0})}),this.el.addEventListener("enter-vr",this.onEnterVR)},initAudioContext:function(){if(this.audioContext)return;const t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.data.fftSize,this.analyser.smoothingTimeConstant=this.data.smoothing,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.data.src){const e=this.data.src;(e.tagName==="AUDIO"||e.tagName==="VIDEO")&&(this.source=this.audioContext.createMediaElementSource(e),this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination))}else navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(console.log("Requesting microphone access..."),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{console.log("Microphone access granted"),this.source=this.audioContext.createMediaStreamSource(e),this.source.connect(this.analyser)}).catch(e=>console.error("Microphone access denied:",e)));this.isAudioRunning=!0,console.log("Audio Context Initialized")},startAudio:function(){this.data.enabled&&(this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume().then(()=>{console.log("Audio Context Resumed")}),this.audioContext||this.initAudioContext())},onEnterVR:function(){this.startAudio()},tick:function(){if(!this.isAudioRunning||!this.analyser)return;this.analyser.getByteFrequencyData(this.dataArray);const t=this.getAverageFrequency(0,10),e=this.getAverageFrequency(10,100),s=this.getAverageFrequency(100,500);this.el.emit("audio-analysis",{bass:t/255,mid:e/255,high:s/255,raw:this.dataArray}),this.el.systems["audio-reactive"]||this.el.sceneEl.setAttribute("audio-reactive-system","")},getAverageFrequency:function(t,e){let s=0;const n=Math.min(t+e,this.bufferLength),a=n-t;if(a===0)return 0;for(let i=t;i<n;i++)s+=this.dataArray[i];return s/a}});AFRAME.registerSystem("audio-reactive",{init:function(){this.data={bass:0,mid:0,high:0},this.el.addEventListener("audio-analysis",t=>{this.data=t.detail})},getAudioData:function(){return this.data}});AFRAME.registerComponent("dimension-warp",{schema:{starCount:{type:"number",default:2500},rayCount:{type:"number",default:80},speed:{type:"number",default:50}},init:function(){this.audioSystem=this.el.sceneEl.systems["audio-analyzer"],this.handSystem=this.el.sceneEl.systems["hand-distance"],this.warpGroup=new THREE.Group,this.el.setObject3D("warp-group",this.warpGroup),this.targetDirection=new THREE.Vector3(0,0,-1),this.currentQuaternion=new THREE.Quaternion,this.targetQuaternion=new THREE.Quaternion,this.steeringOffset=new THREE.Vector2(0,0),this.targetSteering=new THREE.Vector2(0,0),this.slowdownFactor=1,this.targetSlowdown=1,this.boostFactor=1,this.targetBoost=1,this.createStarField(),this.createLightRays(),this.createCentralGlow(),this.tick=this.tick.bind(this),this.el.sceneEl.addEventListener("loaded",()=>{const t=document.querySelector("#leftHand"),e=document.querySelector("#rightHand");t&&(t.addEventListener("gesture-fist",()=>{this.targetSlowdown=.05}),t.addEventListener("gesture-fist-end",()=>{this.targetSlowdown=1}),t.addEventListener("pinchstarted",()=>{this.targetBoost=3}),t.addEventListener("pinchended",()=>{this.targetBoost=1})),e&&(e.addEventListener("gesture-fist",()=>{this.targetSlowdown=.05}),e.addEventListener("gesture-fist-end",()=>{this.targetSlowdown=1}),e.addEventListener("pinchstarted",()=>{this.targetBoost=3}),e.addEventListener("pinchended",()=>{this.targetBoost=1}))})},createStarField:function(){const t=this.data.starCount,e=new THREE.BufferGeometry,s=new Float32Array(t*3),n=new Float32Array(t),a=new Float32Array(t),i=new Float32Array(t*3);for(let h=0;h<t;h++){const u=Math.random()*Math.PI*2,d=Math.random()*40+3,l=Math.random()*350-250;s[h*3]=Math.cos(u)*d,s[h*3+1]=Math.sin(u)*d,s[h*3+2]=l,n[h]=Math.random()*3+1,a[h]=Math.random()*.5+.75;const c=Math.random()*.3+.7;i[h*3]=c*.6,i[h*3+1]=c*.9,i[h*3+2]=c}e.setAttribute("position",new THREE.BufferAttribute(s,3)),e.setAttribute("size",new THREE.BufferAttribute(n,1)),e.setAttribute("speed",new THREE.BufferAttribute(a,1)),e.setAttribute("color",new THREE.BufferAttribute(i,3));const g=new THREE.ShaderMaterial({uniforms:{uTime:{value:0},uIntensity:{value:1}},vertexShader:`
                attribute float size;
                attribute float speed;
                attribute vec3 color;
                
                varying vec3 vColor;
                varying float vAlpha;
                
                void main() {
                    vColor = color;
                    
                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                    
                    // Size attenuation based on distance
                    float dist = -mvPosition.z;
                    gl_PointSize = size * (150.0 / dist);
                    
                    // Fade out stars that are too close or far
                    vAlpha = smoothstep(5.0, 20.0, dist) * smoothstep(200.0, 100.0, dist);
                    
                    gl_Position = projectionMatrix * mvPosition;
                }
            `,fragmentShader:`
                uniform float uIntensity;
                
                varying vec3 vColor;
                varying float vAlpha;
                
                void main() {
                    // Soft circular glow
                    vec2 center = gl_PointCoord - vec2(0.5);
                    float dist = length(center);
                    
                    // Soft falloff for glow effect
                    float alpha = smoothstep(0.5, 0.0, dist);
                    alpha *= alpha; // Sharper core
                    
                    // Bright core with glow
                    vec3 glowColor = vColor * uIntensity * (1.0 + alpha * 2.0);
                    
                    gl_FragColor = vec4(glowColor, alpha * vAlpha);
                }
            `,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0});this.stars=new THREE.Points(e,g),this.starPositions=s,this.starSpeeds=a,this.starSizes=n,this.warpGroup.add(this.stars)},createLightRays:function(){const t=this.data.rayCount,e=new THREE.Group;this.rays=[];for(let s=0;s<t;s++){const n=Math.random()*Math.PI*2,a=Math.random()*25+5,i=Math.cos(n)*a,g=Math.sin(n)*a,h=Math.random()*250-200,u=Math.random()*20+10,d=Math.random()*.08+.03,l=new THREE.CylinderGeometry(d,d,u,4,1);l.rotateX(Math.PI/2);const c=Math.random()*.5+.5,p=new THREE.Color().setHSL(.55+Math.random()*.1,.8,c),f=new THREE.MeshBasicMaterial({color:p,transparent:!0,opacity:c*.5,blending:THREE.AdditiveBlending}),b=new THREE.Mesh(l,f);b.position.set(i,g,h+u/2),this.rays.push({mesh:b,speed:Math.random()*.5+.75,startX:i,startY:g,zStart:h,length:u,baseOpacity:c*.5}),e.add(b)}this.rayGroup=e,this.warpGroup.add(this.rayGroup)},createCentralGlow:function(){const t=new THREE.CircleGeometry(40,64),e=new THREE.ShaderMaterial({uniforms:{uIntensity:{value:.25},uColor:{value:new THREE.Color(35071)}},vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform float uIntensity;
                uniform vec3 uColor;
                varying vec2 vUv;
                
                void main() {
                    vec2 center = vUv - vec2(0.5);
                    float dist = length(center) * 2.0; // Normalize to 0-1 range
                    
                    // Smooth radial gradient that fades completely at edges
                    float glow = 1.0 - smoothstep(0.0, 1.0, dist);
                    glow = pow(glow, 2.0) * uIntensity;
                    
                    // Subtle radial streaks for added visual interest
                    float angle = atan(center.y, center.x);
                    float streaks = sin(angle * 16.0) * 0.5 + 0.5;
                    streaks = pow(streaks, 8.0) * 0.15 * glow;
                    
                    float alpha = glow + streaks;
                    
                    // Boost core brightness (reduced to prevent burn-out)
                    vec3 finalColor = mix(uColor, vec3(0.9, 0.95, 1.0), glow * 0.3);
                    
                    gl_FragColor = vec4(finalColor * (0.8 + glow * 0.5), alpha);
                }
            `,blending:THREE.AdditiveBlending,depthWrite:!1,transparent:!0,side:THREE.DoubleSide});this.centralGlow=new THREE.Mesh(t,e),this.centralGlow.position.z=-180,this.warpGroup.add(this.centralGlow)},tick:function(t,e){if(!this.stars)return;this.slowdownFactor+=(this.targetSlowdown-this.slowdownFactor)*.1,this.boostFactor+=(this.targetBoost-this.boostFactor)*.15;const s=e/1e3*this.slowdownFactor*this.boostFactor;let n=0,a=0,i=0;if(this.audioSystem&&this.audioSystem.isPlaying){const r=this.audioSystem.getBands();r&&(n=r.bass*2,a=r.mid*1.5,i=r.high*1.5)}else{const r=t*.001;n=(Math.sin(r*2)*.5+.5)*.5,a=(Math.sin(r*3+1)*.5+.5)*.3,i=(Math.sin(r*5+2)*.5+.5)*.2}const g=this.data.speed,h=n*200,d=(g+h)*this.boostFactor*s/this.boostFactor,l=this.stars.geometry.attributes.position.array,c=this.data.starCount;for(let r=0;r<c;r++){const o=r*3;if(l[o+2]+=d*this.starSpeeds[r],l[o+2]>50){const m=Math.random()*Math.PI*2,y=Math.random()*40+3;l[o]=Math.cos(m)*y,l[o+1]=Math.sin(m)*y,l[o+2]=-250+Math.random()*50}}this.stars.geometry.attributes.position.needsUpdate=!0;const p=.8+n*1.5+i*.8+(this.boostFactor-1)*.5;this.stars.material.uniforms.uIntensity.value=p;for(let r=0;r<this.rays.length;r++){const o=this.rays[r];o.mesh.position.z+=d*o.speed,o.mesh.position.z>50&&(o.mesh.position.x=o.startX,o.mesh.position.y=o.startY,o.mesh.position.z=o.zStart+o.length/2),o.mesh.material.opacity=o.baseOpacity*(1+a*3+this.boostFactor*.3)}const f=1/(1+(this.boostFactor-1)*.3),b=(.2+n*.4)*f;this.centralGlow.material.uniforms.uIntensity.value=b,this.centralGlow.rotation.z+=s*(.1+this.boostFactor*.2)},remove:function(){this.el.removeObject3D("warp-group")}});console.log("VR Environment Loaded - Hybrid Mode with Grabbable Wand & Invito");AFRAME.registerComponent("hello-world",{init:function(){console.log("Hello, World!")}});
