(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const p="MusicDatabase",c="tracks",y=1,u={openDB:function(){return new Promise((e,t)=>{const s=indexedDB.open(p,y);s.onerror=n=>t("DB Error: "+n.target.error),s.onupgradeneeded=n=>{const r=n.target.result;r.objectStoreNames.contains(c)||r.createObjectStore(c)},s.onsuccess=n=>e(n.target.result)})},saveTrack:async function(e){if(!e)return;const t=await this.openDB();return new Promise((s,n)=>{const a=t.transaction([c],"readwrite").objectStore(c).put(e,"current_track");a.onsuccess=()=>s(!0),a.onerror=l=>n(l.target.error)})},getTrack:async function(){const e=await this.openDB();return new Promise((t,s)=>{const o=e.transaction([c],"readonly").objectStore(c).get("current_track");o.onsuccess=a=>{const l=a.target.result;t(l||null)},o.onerror=a=>s(a.target.error)})}};window.MusicStore=u;let f=new Audio,d=!1;function w(){return localStorage.getItem("preferredLanguage")||"hu"}function g(e){return window.translations&&window.translations[w()][e]||e}window.loadDemo=async function(e,t){i("audioStatusLoading",!0);try{const n=await(await fetch(e)).blob(),r=new File([n],t,{type:"audio/mp3"});await u.saveTrack(r),m(r),i("✅ "+t,!1,!0)}catch(s){i("Error: "+s.message,!1,!0),console.error(s)}};window.loadFromUrlInput=async function(){const e=document.getElementById("url-input").value.trim();e&&window.loadDemo(e,"URL Track")};document.getElementById("music-upload").addEventListener("change",async e=>{const t=e.target.files[0];t&&(i("audioStatusLoading",!0),await u.saveTrack(t),m(t),i("✅ "+t.name,!1,!0))});u.getTrack().then(e=>{e&&(m(e),i("✅ "+e.name,!1,!0))});function i(e,t=!1,s=!1){const n=document.getElementById("music-status");s?(n.textContent=e,n.removeAttribute("data-lang")):(n.setAttribute("data-lang",e),n.textContent=g(e)),n.style.opacity=t?.7:1,document.querySelectorAll("button").forEach(o=>o.disabled=t),t||(document.getElementById("play-preview-btn").disabled=!1)}function m(e){f.src=URL.createObjectURL(e),document.getElementById("play-preview-btn").disabled=!1}window.togglePreview=function(){const e=document.getElementById("play-text"),t=document.getElementById("visualizer");d?(f.pause(),d=!1,e.setAttribute("data-lang","audioPlay"),e.textContent=g("audioPlay"),t.classList.remove("playing")):(f.play(),d=!0,e.setAttribute("data-lang","audioPause"),e.textContent=g("audioPause"),t.classList.add("playing"))};
