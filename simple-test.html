<!DOCTYPE html>
<html>

<head>
    <title>Simple Test - Fluid Sphere</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <!-- Inline components to ensure no loading issues -->
    <script>
        // Compatibility fix
        if (typeof THREE !== 'undefined' && !THREE.Geometry) {
            THREE.Geometry = THREE.BufferGeometry;
        }

        // 1. Simple Sphere
        AFRAME.registerComponent('simple-fluid', {
            init: function () {
                const geo = new THREE.IcosahedronGeometry(0.3, 16); // Low poly
                const mat = new THREE.MeshNormalMaterial({ wireframe: true });
                this.mesh = new THREE.Mesh(geo, mat);
                this.el.setObject3D('mesh', this.mesh);
                this.time = 0;
            },
            tick: function (t, dt) {
                this.mesh.rotation.y += 0.01;
                this.mesh.rotation.x += 0.005;
            }
        });

        // 2. Simple Hand Tracker
        AFRAME.registerComponent('simple-tracker', {
            init: function () {
                this.sphere = document.querySelector('#target-sphere');
                // Debug Box at hand
                this.box = document.createElement('a-box');
                this.box.setAttribute('scale', '0.05 0.05 0.05');
                this.box.setAttribute('color', 'red');
                this.el.appendChild(this.box);
            },
            tick: function () {
                const myPos = this.el.object3D.position;
                if (this.sphere) {
                    const spherePos = this.sphere.object3D.position;
                    const dist = myPos.distanceTo(spherePos);

                    if (dist < 0.5) {
                        this.box.setAttribute('color', 'green');
                        this.sphere.object3D.scale.setScalar(1.2); // React!
                    } else {
                        this.box.setAttribute('color', 'red');
                        this.sphere.object3D.scale.setScalar(1.0);
                    }
                }
            }
        });
    </script>
</head>

<body style="background: #000">

    <a-scene background="color: #111">

        <!-- The Sphere -->
        <a-entity id="target-sphere" position="0 1.3 -0.5" simple-fluid></a-entity>

        <!-- Floor -->
        <a-plane position="0 0 -0.5" rotation="-90 0 0" width="4" height="4" color="#222"></a-plane>

        <!-- Rig -->
        <a-entity id="rig">
            <a-camera position="0 1.6 0"></a-camera>

            <a-entity id="left-hand" hand-tracking-controls="hand: left" simple-tracker>
            </a-entity>

            <a-entity id="right-hand" hand-tracking-controls="hand: right" simple-tracker>
            </a-entity>
        </a-entity>

    </a-scene>
</body>

</html>